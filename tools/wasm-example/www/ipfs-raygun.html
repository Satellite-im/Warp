<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Warp Wasm Test</title>
  </head>
  <script type="module">
    import init, * as wasm from './wasm/warp-ipfs/warp_ipfs.js';
    init().then(async (_exports) => {
      console.log(wasm)

      async function account() {
        let tesseract = new wasm.Tesseract()
        tesseract.load_from_storage()

        const passphrase = new Uint8Array([1,2,3,4,5,6,7,8,9,0]);
        tesseract.unlock(passphrase)
        
        let warp = await new wasm.WarpIpfs(wasm.Config.minimal_testing(), tesseract)

        await warp.multipass.create_identity(null, null)

        return warp
      }

      let warp_a = await account()
      let identity_a = await warp_a.multipass.get_own_identity()
      console.log(identity_a)

      let warp_b = await account()
      let identity_b = await warp_b.multipass.get_own_identity()
      console.log(identity_b)

      let conversation = await warp_a.raygun.create_conversation(identity_b.did_key())
      console.log(conversation)
      console.log(conversation.settings())
      
    });
  </script>
  <body>
    <h2>How to use this example:</h2>
    <h3>1 - Make sure the wasm is compiled:</h3>
    <pre>
        wasm-pack build extensions/warp-ipfs --target web --out-dir ../../tools/wasm-example/www/wasm/warp-ipfs
    </pre>
    <h3>2 - Check ouput in the console</h3>
  </body>
</html>