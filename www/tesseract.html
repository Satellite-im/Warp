<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Warp Wasm Test</title>
  </head>
  <script type="module">
    import init, * as wasm from './wasm/warp/warp.js';
    init().then((_exports) => {
      console.log(wasm)

      let tesseract = new wasm.Tesseract()
      tesseract.load_from_storage()
      console.log(`loaded data`)

      const passphrase = new Uint8Array([1,2,3,4,5,6,7,8,9,0]);
      //self.crypto.getRandomValues(passphrase);
      console.log(`passphrase: ${passphrase}`);
      tesseract.unlock(passphrase)
      console.log(`unlocked`)

      if (!tesseract.autosave_enabled()) {
        tesseract.set_autosave()
      }
      console.log(`enabled saving`)

      let key = `mykey`
      if (tesseract.exist(key)) {
        console.log(`${key} exists: ${tesseract.retrieve(key)}`)
      } else {
        console.log(`${key} does not exist yet`)
      }

      tesseract.set(key, `value123`)
      console.log(`set ${key}: ${tesseract.retrieve(key)}`)
      tesseract.set(key, `persisted123`)
      console.log(`set ${key}: ${tesseract.retrieve(key)}`)

      tesseract.save()
      console.log(`saved: ${key}`)
    });
  </script>
  <body>
    <h2>How to use this example:</h2>
    <h3>1 - Make the sure wasm is compiled:</h3>
    <pre>
      wasm-pack build tools/wasm-example --target web --out-dir www/wasm/wasm-example
    </pre>
    <h3>2 - Check ouput in the console</h3>
  </body>
</html>